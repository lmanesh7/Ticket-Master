import{a as R}from"/build/_shared/chunk-OLVAEH7O.js";import{a as he}from"/build/_shared/chunk-KYBFV6QH.js";import{a as ce,b as j,c as de,d as me,e as b,f as x}from"/build/_shared/chunk-4XRWHIFM.js";import{a as le}from"/build/_shared/chunk-A62XF3CA.js";import{a as ne}from"/build/_shared/chunk-J4UCJ3T4.js";import{a as xe}from"/build/_shared/chunk-6HJM7BVW.js";import{b as L}from"/build/_shared/chunk-XX5622KO.js";import{a as be,b as se,c as U,d as X,e as oe,f as Y,g as re}from"/build/_shared/chunk-P5YPHNIW.js";import{a as fe}from"/build/_shared/chunk-PGOH7JLP.js";import{g as ae,k as ie}from"/build/_shared/chunk-BU5VY3X4.js";import{a as ve}from"/build/_shared/chunk-JA4FJ5TH.js";import{a as Te}from"/build/_shared/chunk-FPOB764B.js";import{B as A,D as T,F as Q,G as v,H as Z,J as q,N as ee,Q as W,p as B,y as u}from"/build/_shared/chunk-Z6MCQOJL.js";import{a as pe,m as V,q as te}from"/build/_shared/chunk-6KANJRLS.js";import{c as n}from"/build/_shared/chunk-Q3IECNXJ.js";var g=n(be()),ge=n(fe());var i=n(pe()),F=n(he());var ye=n(xe()),Se=n(Te());var ke=n(ve());var e=n(te()),Ae=R.object({fixtureId:R.string().min(1,"Fixture is required"),noOfTickets:R.preprocess(Number,R.number().min(1,"No of tickets is required"))});function ue(){var w,D,N,C,I,O,M;let a=i.useId(),s=V(),{orders:h,fixtures:r}=L(),[c,p]=i.useState((D=(w=r[0])==null?void 0:w.id)!=null?D:null),[l,d]=i.useState(),[m,y]=i.useState(1),[z,f]=B(!1,{onClose:()=>{p(null),y(1)}}),S=s.state!=="idle",k=i.useMemo(()=>!l||!m?0:l.pricePerSeat*m,[l,m]),E=i.useMemo(()=>r.filter(t=>{var o;return(o=t.timeSlot)!=null&&o.date?new Date(t.timeSlot.date)>new Date:!1}),[r]);return i.useEffect(()=>{c&&d(r.find(t=>t.id===c))},[c,r]),i.useEffect(()=>{var t;s.state!=="idle"&&s.submission===void 0||(t=s.data)!=null&&t.success&&f.close()},[(N=s.data)==null?void 0:N.success,s.state,s.submission]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"flex max-w-screen-xl flex-col gap-12 p-10",children:(0,e.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,e.jsx)(ne,{title:"My Tickets",rightSection:(0,e.jsx)(v,{color:"dark",radius:"md",onClick:()=>f.open(),leftIcon:(0,e.jsx)(ie,{size:18}),children:"Create"})}),h.length>0?(0,e.jsx)("div",{className:"flow-root",children:(0,e.jsx)("div",{className:"inline-block min-w-full py-2 align-middle",children:(0,e.jsxs)(ce,{children:[(0,e.jsx)(me,{children:(0,e.jsxs)(j,{children:[(0,e.jsx)(b,{pos:"first",children:"Ticket ID"}),(0,e.jsx)(b,{children:"Match"}),(0,e.jsx)(b,{children:"No of Tickets"}),(0,e.jsx)(b,{children:"Total Price"}),(0,e.jsx)(b,{children:"Status"}),(0,e.jsx)(b,{pos:"last",children:(0,e.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,e.jsx)(de,{children:h.map((t,o)=>(0,e.jsx)(we,{order:t,idx:o},t.id))})]})})}):(0,e.jsx)(le,{label:"No tickets have been purchased yet",icon:(0,e.jsx)(ae,{size:70,className:"text-gray-600"})})]})}),(0,e.jsx)(q,{opened:z,onClose:()=>f.close(),title:"Buy tickets",centered:!0,overlayBlur:1.2,overlayOpacity:.6,children:(0,e.jsx)(s.Form,{method:"post",replace:!0,children:(0,e.jsxs)("fieldset",{disabled:S,className:"flex flex-col gap-4",children:[(0,e.jsx)(W,{name:"fixtureId",label:"Fixture",itemComponent:De,value:c,onChange:t=>p(t),data:E.map(t=>{var o,P,H,$,G,_,J,K;return{fixtureDate:(o=t.timeSlot)==null?void 0:o.date,fixtureStartTime:(P=t.timeSlot)==null?void 0:P.start,fixtureEndTime:(H=t.timeSlot)==null?void 0:H.end,stadium:($=t.stadium)==null?void 0:$.name,teamOne:(G=t.teamOne)==null?void 0:G.name,teamTwo:(_=t.teamTwo)==null?void 0:_.name,label:`${(J=t.teamOne)==null?void 0:J.name} vs ${(K=t.teamTwo)==null?void 0:K.name}`,value:t.id}}),error:(I=(C=s.data)==null?void 0:C.fieldErrors)==null?void 0:I.fixtureId,required:!0}),(0,e.jsx)(ee,{name:"noOfTickets",label:"No of tickets",value:m,onChange:t=>y(t),error:(M=(O=s.data)==null?void 0:O.fieldErrors)==null?void 0:M.noOfTickets,min:1,required:!0}),l?(0,e.jsxs)("p",{className:"text-sm",children:["Available Seats: ",l.availableSeats]}):null,(0,e.jsx)("p",{className:"text-sm",children:k?`Total price: ${Y(k)}`:null}),(0,e.jsx)(W,{label:"Payment method",clearable:!1,required:!0,defaultValue:g.PaymentMethod.CREDIT_CARD,data:Object.values(g.PaymentMethod).map(t=>({label:se(t.replace(/_/g," ")),value:t}))}),(0,e.jsx)(T.Wrapper,{id:a,label:"Credit card number",required:!0,children:(0,e.jsx)(T,{id:a,component:F.default,mask:"9999 9999 9999 9999",placeholder:"XXXX XXXX XXXX XXXX",defaultValue:"4242 4242 4242 4242",alwaysShowMask:!1})}),(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)(T.Wrapper,{id:a+"cvv",label:"CVV",required:!0,children:(0,e.jsx)(T,{id:a+"cvv",name:"cvv",component:F.default,mask:"999",placeholder:"XXX",defaultValue:"123",alwaysShowMask:!1})}),(0,e.jsx)(T.Wrapper,{id:a+"cvv",label:"Expiry",required:!0,children:(0,e.jsx)(T,{id:a+"expiryDate",name:"expiryDate",component:F.default,mask:"99/9999",placeholder:"MM/YYYY",alwaysShowMask:!1,defaultValue:"12/2029"})})]}),(0,e.jsxs)("div",{className:"mt-1 flex items-center justify-end gap-4",children:[(0,e.jsx)(v,{variant:"subtle",disabled:S,onClick:()=>f.close(),color:"red",children:"Cancel"}),(0,e.jsx)(v,{type:"submit",loading:S,loaderPosition:"right",children:"Buy tickets"})]})]})})})]})}function we({order:a,idx:s}){var k,E,w,D,N,C,I,O,M,t;let{orders:h}=L(),r=V(),[c,p]=B(!1),l=a.tickets.map(o=>o.seatNo),d=a.status===g.OrderStatus.SUCCESS,m=new Date((E=(k=a.schedule.timeSlot)==null?void 0:k.date)!=null?E:new Date)<new Date(Date.now()+24*60*60*1e3),y=r.state!=="idle",[z,f]=B(!1),S=h.length-1===s;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(j,{hasBorder:!S,children:[(0,e.jsx)(x,{pos:"first",children:a.scheduleId.slice(0,8).toUpperCase()}),(0,e.jsx)(x,{children:(0,e.jsxs)("div",{className:"flex flex-col",children:[(0,e.jsxs)("div",{className:"font-medium text-gray-900",children:[a.schedule.teamOne.name," vs ",a.schedule.teamTwo.name]}),(0,e.jsx)("div",{className:"font-medium text-gray-500",children:a.schedule.stadium.name}),(0,e.jsx)("div",{className:"font-medium text-gray-500",children:U((D=(w=a.schedule.timeSlot)==null?void 0:w.date)!=null?D:new Date)}),(0,e.jsxs)("div",{className:"text-gray-500",children:[X((C=(N=a.schedule.timeSlot)==null?void 0:N.start)!=null?C:new Date)," -"," ",X((O=(I=a.schedule.timeSlot)==null?void 0:I.end)!=null?O:new Date)]})]})}),(0,e.jsx)(x,{children:a.noOfTickets}),(0,e.jsx)(x,{children:Y((t=(M=a.payment)==null?void 0:M.amount)!=null?t:0)}),(0,e.jsx)(x,{children:(0,e.jsx)(Q,{className:"max-w-min",variant:"dot",fullWidth:!1,color:a.status===g.OrderStatus.SUCCESS?"green":"red",children:re(a.status)})}),(0,e.jsxs)(x,{pos:"last",children:[(0,e.jsxs)(A,{width:200,position:"bottom-start",withArrow:!0,shadow:"md",opened:c,disabled:!d,children:[(0,e.jsx)(A.Target,{children:(0,e.jsx)(v,{onMouseEnter:()=>p.open(),onMouseLeave:()=>p.close(),variant:"subtle",color:"gray",compact:!0,disabled:!d,children:"View Seats"})}),(0,e.jsx)(A.Dropdown,{sx:{pointerEvents:"none"},className:"whitespace-normal break-words",children:oe(l)})]}),(0,e.jsx)(v,{variant:"subtle",color:"gray",compact:!0,loaderPosition:"right",loading:y,disabled:!d,onClick:()=>f.open(),children:"View Tickets"}),(0,e.jsx)(v,{variant:"subtle",color:"red",compact:!0,loaderPosition:"right",loading:y,disabled:!d||m,onClick:()=>r.submit({orderId:a.id,intent:"cancel-order"},{method:"post",replace:!0,action:"/api/cancel-order"}),children:"Cancel Order"})]})]},a.id),(0,e.jsx)(q,{opened:z,onClose:()=>f.close(),title:"Ticket Details",centered:!0,children:(0,e.jsx)("div",{className:"grid grid-cols-2 gap-8",children:a.tickets.map((o,P)=>(0,e.jsxs)(i.Fragment,{children:[(0,e.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,e.jsx)(u,{size:"sm",opacity:.9,children:"Ticket ID"}),(0,e.jsx)(u,{size:"sm",opacity:.9,children:"Seat No."})]}),(0,e.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,e.jsx)(u,{size:"sm",opacity:.7,children:o.id.slice(0,8).toUpperCase()}),(0,e.jsx)(u,{size:"sm",opacity:.7,children:o.seatNo})]})]},P))})})]})}var De=i.forwardRef((a,s)=>{let{teamOne:h,teamTwo:r,fixtureDate:c,fixtureStartTime:p,fixtureEndTime:l,stadium:d,...m}=a;return(0,e.jsx)("div",{ref:s,...m,children:(0,e.jsx)(Z,{noWrap:!0,children:(0,e.jsxs)("div",{children:[(0,e.jsxs)(u,{size:"sm",children:[h," vs ",r]}),(0,e.jsx)(u,{size:"xs",opacity:.65,children:d}),(0,e.jsxs)(u,{size:"xs",opacity:.65,children:[U(c)," (",X(p)," -"," ",X(l),")"]})]})})})});export{ue as default};
